import requests
import time
nurl = "https://api.telegram.org/bot"
token = '421347401:AAEZMIsjJT3yOh-68r_TJ0FjdTQo8O177BM/'
url = nurl + token
send = 'sendMessage'
get = 'getUpdates'
my_chat = 121143792


def send_message(chat, message):
    """Send message to the chat."""""
    params = {"chat_id" : chat, "text": message}
    response = requests.post(url + send, data=params)
    print(url + send, params)
    return response


def get_updates_json(request):
    """Gets json of messages"""
    response = requests.get(request + get)
    return response.json()


def get_last_update(data):
    results = data['result']
    total_updates = len(results) - 1
    return results[total_updates]


def get_chat_id(update):
    chat_id = update['message']['chat']['id']
    return chat_id


def main():
    last_update = get_last_update(get_updates_json(url))['update_id']
    for x in range(1,1000): # replace with endless loop.
        if last_update == get_last_update(get_updates_json(url))['update_id']:
            send_message(get_chat_id(get_last_update(get_updates_json(url))),'PIZDEC LOSHARA')
            last_update += 1
        time.sleep(1)


main()
